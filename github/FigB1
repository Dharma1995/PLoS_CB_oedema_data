#!/usr/bin/env python3
# -*- coding: utf-8 -*- 

import matplotlib.pyplot as plt
import numpy as np
from sklearn.linear_model import LinearRegression
from scipy import log
from scipy.optimize import curve_fit
import math
import pandas as pd

dictp = {}
dictm = {}
dicts = {}
dictc = {}
dict0 = {}
for i in [3,5,6,14,25,28,32,38,42,47,51,53,56,60,62,67,69]:
   dfp = pd.read_csv('/home/chenxi/Desktop/Contact/github/IDS/'+str(i)+'/icp_mls.csv')
   p = dfp['ICP'].tolist()
   p.insert(0, 1330)
   dictp['p'+str(i)] = p
   m = dfp['MLS'].tolist()
   m.insert(0,0)
   dictm['m'+str(i)] = m
   print(m)
   
dictp['pstd'] = [1330, 1748.9229668175838, 2045.4501348868507, 2260.591270921171, 2416.7156106313537, 2531.460700351373, 2616.2826820090368, 2678.532255281759, 2724.0433546054837]
dictm['mstd'] = [0, -0.0008311157304833141, -0.0015341752828098368, -0.0020775453844619676, -0.002482702141065397, -0.0027821105323242263, -0.0030033289197561146, -0.003167453820292292, -0.003289928318694662]
dictc['cstd'] = [0, 1125.4378043636536, 1776.7307789747833, 2213.371707032013, 2534.498096712936, 2777.796399816565, 2961.589977421732, 3103.1057061628994, 3216.7653687490065]
dicts['sstd'] = [0, 303.6085317457973, 516.7448367498305, 663.3397880620109, 789.3946017227686, 881.683329234359, 944.9327274999588, 987.1544883974494, 1014.9807520769054]

#3
dictc['c3'] = [0,1476.9853965469165, 1808.9991847281663, 2214.9268792389835, 2527.728698864567, 2750.2395810779412, 2928.2282796089517, 3039.364722403363, 3129.49306012235]
dicts['s3'] = [0, 343.56281672951775, 587.9062580797844, 760.1646508232628, 865.0136491754016, 930.5959175593491, 967.1013256992509, 986.6522403131672, 997.8712017953437]
#5
dictc['c5'] = [0,1145.2845792675228, 1771.258796902015, 2261.15083993742, 2601.038292714276, 2835.1055764102484, 2991.7647528044286, 3085.2487235480467, 3152.941639527786]
dicts['s5'] = [0,362.81331359737817, 596.9902078791267, 772.6699466065163, 884.8093426291921, 946.844584591993, 983.9864744440265, 1007.541210764753, 1020.5023094553678]
#6
dictc['c6'] = [0,1297.9544152082233, 1961.1097890972922, 2491.6000204474635, 2702.8070076469494, 2821.860147335083, 2888.74061884366, 2923.77458157752, 2942.688350862936]
dicts['s6'] = [0,360.36113065818125, 593.4266309015011, 749.1084340879504, 856.545429945463, 929.6159207480608, 973.1488461734957, 998.1002512651386, 1012.2958256675469]
#14
dictc['c14'] = [0,1230.7919652012051, 1899.444081661129, 2364.5045995507385, 2686.41095197509, 2875.070360103657, 3010.7066795048695, 3071.6418632420573, 3128.021103799453]
dicts['s14'] = [0,373.21982230258226, 625.2169826751098, 762.4546475958285, 877.7553385519967, 946.4366194082913, 984.3747583891206, 1007.9451233873591, 1023.4891499117944]
#25
dictc['c25'] = [0,1226.246655295943, 2672.6341709672215, 3475.283889530541, 3864.8143669854053, 4065.625393205675, 4222.8617173917155, 4271.91919316479, 4312.976148545809]
dicts['s25'] = [0,359.30834606923736, 601.4621268927317, 776.8596562055934, 882.3557475090008, 1046.3983325039321, 983.1178956417431, 1005.1300484981174, 1017.526193770436]
#28
dictc['c28'] = [0,1266.1550426943265, 1978.0924710890054, 2427.8806426759093, 2765.00933721699, 2963.576338761072, 3134.4915462788927, 3220.672026460943, 3308.5311851457036]
dicts['s28'] = [0,359.56118060935563, 588.6924225562105, 753.8922905766892, 870.9227524004624, 939.4022648326757, 977.2841574725975, 997.1305354739632, 1010.8231289655492]
#38
dictc['c38'] = [0,1363.2880896759395, 1745.8158899501607, 2071.969441248056, 2332.9684134333806, 2572.2298135164488, 2754.2774295886397, 2874.435808342901, 2953.7055709448505]
dicts['s38'] = [0,385.80934690708546, 623.9155063119871, 772.3898049156437, 878.8420997684146, 938.5183278048272, 982.4629228907426, 1006.9274843339272, 1020.4562416427648]
#42
dictc['c42'] = [0,1381.265495646148, 1911.2534279102458, 2326.9428310655544, 2620.983430126436, 2817.145162128077, 2964.6588635017065, 3035.9576850365074, 3104.1841602069544]
dicts['s42'] = [0,397.3091564320576, 660.3649863065046, 808.7941684181623, 932.2713540217975, 1007.0912056493007, 1049.755846076499, 1072.9166881486485, 1085.4831046025802]
#47
dictc['c47'] = [0,1652.9003438054729, 1993.6218976477078, 2442.674663734967, 2650.747369076781, 2957.1931425826815, 3083.9353444511235, 3255.1784795539543, 3289.747317501937]
dicts['s47'] = [0,391.54007656941934, 631.8094375712516, 762.3692862064449, 877.7977628970791, 948.5790876614511, 988.6296550492484, 1010.07664133588, 1023.8318028564621]
#56
dictc['c56'] = [0,1458.115261190928, 1914.1463196015502, 2495.2723505613862, 2844.992287208699, 3033.58886096219, 3139.3363448145537, 3198.213479238704, 3231.182775690798]
dicts['s56'] = [0,365.6531725407884, 609.9109104447696, 750.0892515371617, 862.4416125837217, 931.4886883969933, 971.2153181263731, 993.2559776832607, 1005.4657924263535]
#60
dictc['c60'] = [0,1383.942845468428, 1956.7994139091113, 2453.8574872908907, 2773.3289366253243, 2986.1567513908726, 3115.9447961179476, 3191.832122860564, 3244.2978186603077]
dicts['s60'] = [0,400.18491474937616, 659.7171283287136, 850.2816244226593, 974.9674507713834, 1042.5963831603199, 1077.337455708291, 1094.093258847794, 1102.2583486868846]
#69
dictc['c69'] = [0,1389.759563565625, 1858.6026606286623, 2299.6047634630836, 2541.311635815944, 2665.4308660138813, 2757.084597316963, 2848.790316746671, 2921.238042139643]
dicts['s69'] = [0,358.7547437397854, 593.1002845512669, 765.9708366662045, 868.9253624767987, 936.1200269630631, 976.8210847589029, 999.4409469284248, 1011.9948566738032]

dictc['c51'] = [0,604.4385615104621, 1085.5395526750349, 1581.0699344158797, 2011.248667259417, 2367.926367031475, 2655.8872539402914, 2884.663189516682, 3064.792371361328]
dicts['s51'] = [0,276.42676175581914, 471.0114849851565, 613.4956650795849, 723.3335105006572, 814.7957259544218, 881.0690891924723, 928.2626436884882, 961.5609960685848]

dictc['c53'] = [0,674.332373043947, 1157.7806063888352, 1527.7318597562555, 1820.9283621927825, 2088.7256392725144, 2301.6898034339006, 2465.586056747468, 2590.874988378511]
dicts['s53'] = [0,273.3239757536639, 463.94683408869383, 593.9655972772701, 700.2688956278758, 790.7662206298254, 857.7539808085143, 906.5050150059052, 941.6114562129585]

dictc['c32'] = [0,627.2774850627419, 1093.3260848980913, 1419.9776989803852, 1737.8131031129003, 2071.9964518031998, 2327.0658999906614, 2519.3401506738205, 2663.681528491186]
dicts['s32'] = [0,255.87790635479746, 444.740841004585, 603.8572079391556, 725.6214398438802, 815.3109544738758, 879.6734149862588, 925.1049546623937, 956.9379736052564]

dictc['c62'] = [0,781.866541821522, 1390.401564980776, 1916.9884891211732, 2276.6762962306834, 2515.7674677367713, 2676.8804377999786, 2787.7649816112375, 2865.425701803448]
dicts['s62'] = [0,266.83942790999316, 453.0502673903161, 607.0553933525885, 721.5232072753898, 806.1893441790396, 870.3778733774882, 916.1178467596006, 948.498254827653]

dictc['c67'] = [0,1221.3316405070855, 1700.6964766511132, 2053.810237973987, 2251.2068597173447, 2424.285710996729, 2528.8325443252816, 2628.95265382423, 2693.1088241799007]
dicts['s67'] = [0,337.31776135260236, 570.9364824706312, 744.4242212318372, 862.436388236092, 931.4289979324294, 969.804081602616, 990.4767248118712, 1001.7300382006681]

dict0.update(dictp)
dict0.update(dictm)
dict0.update(dicts)
dict0.update(dictc)

list_names = ['std','3','5','6','14','25','28','32','38','42','47','51','53','56','60','62','67','69']
x = ['m']
y = ['c']
list_namesx = []
list_namesy = []

for i in list_names: 
   list_namesx.append(x[0] + i)
   list_namesy.append(y[0] + i)
print(list_namesx, list_namesy)   

linr_ftx = []
linr_fty = []

plt.rcParams['xtick.direction'] = 'in'
plt.rcParams['ytick.direction'] = 'in'
plt.figure(figsize = (7,5))
sk = []
S = np.linspace(0,30,20)
S = S[:,None]

for i in [[dict0[list_namesx[0]],dict0[list_namesy[0]],'id:'+str(list_names[0]),'o','tab:blue'], [dict0[list_namesx[1]],dict0[list_namesy[1]],'id:'+str(list_names[1]),'x','tab:green'], [dict0[list_namesx[2]],dict0[list_namesy[2]],'id:'+str(list_names[2]),'s','brown'], [dict0[list_namesx[3]],dict0[list_namesy[3]],'id:'+str(list_names[3]),'s','red'],[dict0[list_namesx[4]],dict0[list_namesy[4]],'id:'+str(list_names[4]),'s','black'], [dict0[list_namesx[5]],dict0[list_namesy[5]],'id:'+str(list_names[5]),'s','red'], [dict0[list_namesx[6]],dict0[list_namesy[6]],'id:'+str(list_names[6]),'s','tab:red'], [dict0[list_namesx[7]],dict0[list_namesy[7]],'id:'+str(list_names[7]),'s','grey'], [dict0[list_namesx[8]],dict0[list_namesy[8]],'id:'+str(list_names[8]),'s','grey'], [dict0[list_namesx[9]],dict0[list_namesy[9]],'id:'+str(list_names[9]),'s','grey'], [dict0[list_namesx[10]],dict0[list_namesy[10]],'id:'+str(list_names[10]),'s','grey'],  [dict0[list_namesx[11]],dict0[list_namesy[11]],'id:'+str(list_names[11]),'s','tab:red'], [dict0[list_namesx[12]],dict0[list_namesy[12]],'id:'+str(list_names[12]),'s','grey'], [dict0[list_namesx[13]],dict0[list_namesy[13]],'id:'+str(list_names[13]),'s','grey'],[dict0[list_namesx[14]],dict0[list_namesy[14]],'id:'+str(list_names[14]),'s','grey'],[dict0[list_namesx[15]],dict0[list_namesy[15]],'id:'+str(list_names[15]),'s','grey'],[dict0[list_namesx[16]],dict0[list_namesy[16]],'id:'+str(list_names[16]),'s','grey'],[dict0[list_namesx[17]],dict0[list_namesy[17]],'id:'+str(list_names[17]),'s','grey']]:
   a = i[0]
   print(i[0],i[1])
   m = np.absolute(a)
   m = m*1000#/133##
   di = np.ones(len(a))
   di = di*133
   b = i[1]
   p = np.absolute(b)
   p = p
   sample_weight = np.ones(len(a)) 
   sample_weight[0] *= 200
   plt.scatter(m, p, facecolor = 'None', edgecolor = 'grey', marker = 'o', label = i[2])  
   p = p.reshape((len(a), 1))
   m = m.reshape((len(a), 1))
   regr = LinearRegression()
   regr.fit(m, p, sample_weight)
   #plt.plot(S, regr.predict(S), color='grey', linewidth=1.5, alpha = 0.5) 
   linr_ftx = linr_ftx + list(m)
   linr_fty = linr_fty + list(p) 

tuples = sorted(zip(linr_ftx, linr_fty))
linr_ftx, linr_fty = [t[0] for t in tuples], [t[1] for t in tuples]
sample_weight = np.ones(len(linr_ftx)) 
sample_weight[0] *= 200
regr = LinearRegression()
linr_fty = np.array(linr_fty)
linr_ftx = np.array(linr_ftx)
linr_ftx = linr_ftx.reshape((len(linr_ftx),1))
linr_fty = linr_fty.reshape((len(linr_ftx),1))
regr.fit(linr_ftx, linr_fty, sample_weight)
So = np.linspace(0,30,100)
So = So[:, None]
plt.plot(So, regr.predict(So),  color='tab:red', linewidth=2) 
   
font1 = {'family' : 'Arial','weight' : 'normal','size' : 15}
plt.xlabel('MLS (mm)', fontsize = 15)
plt.ylabel('Periventricular Stress (Pa)', fontsize = 15)
plt.xticks(fontsize=15)
plt.yticks(fontsize=15)
plt.xlim((-0.1, 4))
plt.ylim((-100, 4500))
#plt.legend(frameon = False, fontsize = 15)
bwith = 1.5 
TK = plt.gca()
TK.spines['bottom'].set_linewidth(bwith)
TK.spines['left'].set_linewidth(bwith)
TK.spines['top'].set_linewidth(bwith)
TK.spines['right'].set_linewidth(bwith)
plt.show()
